# ๐ง ุญู ุฎุทุฃ "Failed to fetch" - ุฅุตูุงุญ ุดุงูู

## โ ุชู ุญู ุงููุดููุฉ ุจูุฌุงุญ

**ุงูุฃุฎุทุงุก ุงูุชู ุชู ุฅุตูุงุญูุง:**

```
ุฎุทุฃ ูู ุงุณุชุนูุงู ุงูููุชุฌุงุช: [object Object]
ุฎุทุฃ ูู ุงุณุชุนูุงู ุงูููุชุฌุงุช: TypeError: Failed to fetch (NO_CODE)
ุฎุทุฃ ุนุงู ูู getProducts: [object Object]
ุฎุทุฃ ุนุงู ูู getProducts: TypeError: Failed to fetch (NO_CODE)
```

**ููุน ุงูุฎุทุฃ**: ุฎุทุฃ ุดุจูุฉ ุนูู ูุณุชูู ุงููุชุตูุญ - "Failed to fetch"

---

## ๐ ุชุญููู ุงูุณุจุจ ุงูุฌุฐุฑู

### ูุง ูู ุฎุทุฃ "Failed to fetch"ุ

ูุฐุง ุฎุทุฃ ูุญุฏุซ ุนูู ูุณุชูู ุงููุชุตูุญ ุนูุฏูุง:

1. **ูุดุงูู ุงูุดุจูุฉ**:

   - ุงููุทุงุน ุงูุฅูุชุฑ๏ฟฝ๏ฟฝุช
   - ุงุชุตุงู ุจุทูุก ุฃู ุบูุฑ ูุณุชูุฑ
   - ุงููุทุงุน ูุคูุช ูู ุฎุฏูุฉ Supabase

2. **ูุดุงูู ุชูููุฉ**:

   - ุฅุนุฏุงุฏุงุช CORS ุฎุงุทุฆุฉ
   - ุฌุฏุงุฑ ุญูุงูุฉ ูุญุฌุจ ุงูุทูุจุงุช
   - ุงูุชุฏุงุฏุงุช ุงููุชุตูุญ ุชุชุฏุงุฎู
   - ูุดุงูู ูู DNS

3. **ูุดุงูู ุงูุฎุงุฏู**:
   - ุฎุงุฏู Supabase ูุนุทู ูุคูุชุงู
   - ุตูุงูุฉ ุนูู ุงูุฎุงุฏู
   - ูุดุงูู ูู ุงูุชูุฌูู

### ููุงุฐุง ูุงู ุงููุธุงู ุงูุณุงุจู ููุดูุ

- **ูุง ูููุฒ ุจูู ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฎุชููุฉ**
- **ูุง ููุฌุฏ ุขููุฉ ุชุฑุงุฌุน ุฐููุฉ**
- **ุฑุณุงุฆู ุฎุทุฃ ุบูุฑ ูุงุถุญุฉ ([object Object])**
- **ูุง ูุชุญูู ูู ุญุงูุฉ ุงูุดุจูุฉ**

---

## ๐๏ธ ุงูุญููู ุงููุทุจูุฉ

### 1. ุชุญุณูู ุดุงูู ูุฏุงูุฉ `getProducts()`

**ุงูููู**: `src/lib/supabaseService.ts`

#### ุฃ. ูุญุต ุญุงูุฉ ุงูุดุจูุฉ ุฃููุงู

```typescript
// ูุญุต ุญุงูุฉ ุงูุฅูุชุฑูุช ูุจู ุงููุญุงููุฉ
if (!navigator.onLine) {
  console.log("๐ ูุง ููุฌุฏ ุงุชุตุงู ุจุงูุฅูุชุฑูุช - ุงุณุชุฎุฏุงู ุงููุงุด ุงููุญูู");
  return this.getProductsFromCache();
}
```

#### ุจ. ุฅุถุงูุฉ timeout ููุงุณุชุนูุงูุงุช

```typescript
// ุญูุงูุฉ ุถุฏ ุงูุงุณุชุนูุงูุงุช ุงููุนููุฉ
const queryPromise = supabase!.from("products").select("*").order("name");
const timeoutPromise = new Promise((_, reject) =>
  setTimeout(() => reject(new Error("Query timeout")), 10000),
);

const { data, error } = await Promise.race([queryPromise, timeoutPromise]);
```

#### ุฌ. ุชุตููู ุฐูู ููุฃุฎุทุงุก

```typescript
/**
 * ุชุตููู ุฃุฎุทุงุก ุงูุดุจูุฉ
 */
private categorizeNetworkError(error: any): string {
  const errorMessage = error?.message?.toLowerCase() || '';

  if (errorMessage.includes('failed to fetch')) {
    return 'ูุดู ูู ุงููุตูู ููุฎุงุฏู - ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช';
  }

  if (errorMessage.includes('network error')) {
    return 'ุฎุทุฃ ูู ุงูุดุจูุฉ - ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช';
  }

  if (errorMessage.includes('timeout')) {
    return 'ุงูุชูุช ูููุฉ ุงูุงุชุตุงู - ุงูุดุจูุฉ ุจุทูุฆุฉ';
  }

  // ุงููุฒูุฏ ูู ุงูุชุตูููุงุช...
}
```

#### ุฏ. ุขููุฉ ุชุฑุงุฌุน ุฐููุฉ

```typescript
/**
 * ุงูุญุตูู ุนูู ุงูููุชุฌุงุช ูู ุงููุงุด ุงููุญูู
 */
private async getProductsFromCache(): Promise<Product[]> {
  try {
    if (offlineManager && typeof offlineManager.getProducts === 'function') {
      const offlineProducts = await offlineManager.getProducts();
      if (offlineProducts && offlineProducts.length > 0) {
        console.log(`๐ฑ ุชู ุงูุญุตูู ุนูู ${offlineProducts.length} ููุชุฌ ูู ุงููุงุด ุงููุญูู`);
        return offlineProducts;
      }
    }

    console.warn("โ๏ธ ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงููุงุด ุงููุญูู");
    return [];
  } catch (cacheError: any) {
    logError("ูุดู ูู ุฌูุจ ุงูููุชุฌุงุช ูู ุงููุงุด:", cacheError);
    return [];
  }
}
```

### 2. ูุงุดู ุญุงูุฉ ุงูุดุจูุฉ ุงููุชูุฏู

**ุงูููู ุงูุฌุฏูุฏ**: `src/lib/networkStatusDetector.ts`

#### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

- โ **ูุฑุงูุจุฉ ูุณุชูุฑุฉ** ูุญุงูุฉ ุงูุดุจูุฉ
- โ **ูุญุต ุฌูุฏุฉ ุงูุงุชุตุงู** (ุฌูุฏ/ุถุนูู/ูุนุทู)
- โ **ูุดู ุงุณุชูุฑุงุฑ ุงูุงุชุตุงู**
- โ **ุชุญุฏูุฏ ูุชู ูุฌุจ ุฅุนุงุฏุฉ ุงููุญุงููุฉ**

```typescript
// ูุซุงู ุนูู ุงูุงุณุชุฎุฏุงู
const status = NetworkStatusDetector.getStatus();
console.log({
  isOnline: status.isOnline,
  quality: status.quality, // 'good', 'poor', 'offline'
  stable: NetworkStatusDetector.isConnectionStable(),
  message: NetworkStatusDetector.getStatusMessage(),
});
```

#### ูุญุต ุฌูุฏุฉ ุงูุงุชุตุงู:

```typescript
private static async checkConnectionQuality() {
  try {
    const startTime = Date.now();

    const response = await fetch("https://www.google.com/favicon.ico", {
      method: "HEAD",
      mode: "no-cors",
      cache: "no-cache",
    });

    const latency = Date.now() - startTime;

    if (latency < 1000) {
      this.connectionQuality = "good";
    } else {
      this.connectionQuality = "poor";
    }
  } catch (error) {
    this.connectionQuality = "poor";
  }
}
```

### 3. ุชุญุณูู ุฃุฏุงุฉ ุงูุชุดุฎูุต

**ุงูููู**: `src/components/ConnectionDiagnostic.tsx`

#### ุฅุถุงูุฉ ูุฑุงูุจุฉ ุฌูุฏุฉ ุงูุดุจูุฉ:

```typescript
const [testResults, setTestResults] = useState({
  networkOnline: navigator.onLine,
  networkQuality: "good" as "good" | "poor" | "offline", // ุฌุฏูุฏ
  supabaseConfigured: false,
  databaseConnection: false,
  productsReadable: false,
  lastError: "",
});
```

#### ุนุฑุถ ูุนูููุงุช ููุตูุฉ:

```typescript
// ุนุฑุถ ุญุงูุฉ ุงูุดุจูุฉ ูุน ุงูุฌูุฏุฉ
const networkStatus = NetworkStatusDetector.getStatus();
console.log("๐ ุญุงูุฉ ุงูุดุจูุฉ:", {
  online: networkStatus.isOnline,
  quality: networkStatus.quality,
  stable: NetworkStatusDetector.isConnectionStable(),
});
```

---

## ๐ ุณููุงุฑูููุงุช ุงูุงุณุชุฎุฏุงู ุงููุฎุชููุฉ

### 1. ุงูุงุชุตุงู ุงูุทุจูุนู โ

```
๐ฆ ูุญุงููุฉ ุฌูุจ ุงูููุชุฌุงุช ูู Supabase...
โ ุชู ุฌูุจ 3 ููุชุฌ ูู Supabase ุจูุฌุงุญ
๐พ ุชู ุชุฎุฒูู ุงูููุชุฌุงุช ูู ุงููุงุด ุจูุฌุงุญ
```

### 2. ููุฏุงู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ๐

```
๐ ูุง ููุฌุฏ ุงุชุตุงู ุจุงูุฅูุชุฑูุช - ุงุณุชุฎุฏุงู ุงููุงุด ุงููุญูู
๐ฑ ุชู ุงูุญุตูู ุนูู 3 ููุชุฌ ูู ุงููุงุด ุงููุญูู
```

### 3. ุฎุทุฃ "Failed to fetch" ๐

```
๐ฆ ูุญุงููุฉ ุฌูุจ ุงูููุชุฌุงุช ูู Supabase...
โ๏ธ ูุดู ูู ุงููุตูู ููุฎุงุฏู - ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช - ุงูุชุฑุงุฌุน ูููุงุด ุงููุญูู
๐ฑ ุชู ุงูุญุตูู ุนูู 3 ููุชุฌ ูู ุงููุงุด ุงููุญูู
```

### 4. ุงูุชูุงุก ูููุฉ ุงูุงุณุชุนูุงู โฑ๏ธ

```
๐ฆ ูุญุงููุฉ ุฌูุจ ุงูููุชุฌุงุช ูู Supabase...
โ๏ธ ุงูุชูุช ูููุฉ ุงูุงุชุตุงู - ุงูุดุจูุฉ ุจุทูุฆุฉ - ุงูุชุฑุงุฌุน ูููุงุด ุงููุญูู
๐ฑ ุชู ุงูุญุตูู ุนูู 3 ููุชุฌ ูู ุงููุงุด ุงููุญูู
```

### 5. ูุง ููุฌุฏ ูุงุด ูุชููุฑ โ๏ธ

```
๐ ูุง ููุฌุฏ ุงุชุตุงู ุจุงูุฅูุชุฑูุช - ุงุณุชุฎุฏุงู ุงููุงุด ุงููุญูู
โ๏ธ ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงููุงุด ุงููุญูู
[] (ูุงุฆูุฉ ูุงุฑุบุฉ ูุน ุฑุณุงูุฉ ูุงุถุญุฉ)
```

---

## ๐ฏ ูููุฒุงุช ุงููุธุงู ุงูุฌุฏูุฏ

### ุฃ. ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ููููุฏุฉ

**ูุจู ุงูุฅุตูุงุญ**:

```
ุฎุทุฃ ูู ุงุณุชุนูุงู ุงูููุชุฌุงุช: [object Object]
ุฎุทุฃ ุนุงู ูู getProducts: [object Object]
```

**ุจุนุฏ ุงูุฅุตูุงุญ**:

```
โ๏ธ ูุดู ูู ุงููุตูู ููุฎุงุฏู - ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช
โ๏ธ ุงูุชูุช ูููุฉ ุงูุงุชุตุงู - ุงูุดุจูุฉ ุจุทูุฆุฉ
โ๏ธ ุฎุทุฃ ูู ุงูุดุจูุฉ - ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
```

### ุจ. ุขููุฉ ุชุฑุงุฌุน ุฐููุฉ

1. **ุงููุญุงููุฉ ุงูุฃููู**: Supabase ูุจุงุดุฑุฉ
2. **ุนูุฏ ุงููุดู**: ุงููุงุด ุงููุญูู
3. **ุฅุฐุง ูู ููุฌุฏ ูุงุด**: ูุงุฆูุฉ ูุงุฑุบุฉ ูุน ุฑุณุงูุฉ ูุงุถุญุฉ

### ุฌ. ูุฑุงูุจุฉ ูุณุชูุฑุฉ ููุดุจูุฉ

- **ูุญุต ุฏูุฑู** ูุฌูุฏุฉ ุงูุงุชุตุงู
- **ุฅุดุนุงุฑุงุช ููุฑูุฉ** ุนูุฏ ุชุบููุฑ ุญุงูุฉ ุงูุดุจูุฉ
- **ุชูุตูุงุช ุฐููุฉ** ูุฅุนุงุฏุฉ ุงููุญุงููุฉ

### ุฏ. ุญูุงูุฉ ุถุฏ ุงูุชุนููู

- **ูููุฉ ุฒูููุฉ 10 ุซูุงูู** ููุงุณุชุนูุงูุงุช
- **ุฅูุบุงุก ุชููุงุฆู** ููุทูุจุงุช ุงููุนููุฉ
- **ููุน ุชุฑุงูู ุงูุทูุจุงุช**

---

## ๐ง ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต

### ูููุฉ ุงูุงุณุชุนูุงู:

```typescript
// ูู getProducts()
const timeoutMs = 10000; // 10 ุซูุงูู (ูุงุจู ููุชุนุฏูู)

const timeoutPromise = new Promise((_, reject) =>
  setTimeout(() => reject(new Error("Query timeout")), timeoutMs),
);
```

### ูุญุต ุฌูุฏุฉ ุงูุดุจูุฉ:

```typescript
// ูู NetworkStatusDetector
setInterval(() => {
  this.checkConnectionQuality();
}, 30000); // ูู 30 ุซุงููุฉ (ูุงุจู ููุชุนุฏูู)
```

### ุญุฏ ุงุณุชูุฑุงุฑ ุงูุงุชุตุงู:

```typescript
// ุงุนุชุจุงุฑ ุงูุงุชุตุงู ูุณุชูุฑ ุฅุฐุง ูู ูุชุบูุฑ ูุฃูุซุฑ ูู:
return timeSinceLastChange > 10000; // 10 ุซูุงูู (ูุงุจู ููุชุนุฏูู)
```

---

## ๐ ุฃุฏูุงุช ุงูุชุดุฎูุต

### 1. ุญุงูุฉ ุงูุดุจูุฉ ูู ุงูููุช ุงููุนูู

```typescript
const status = NetworkStatusDetector.getStatus();
console.log("๐ Network Status:", {
  isOnline: status.isOnline,
  quality: status.quality,
  lastOnlineTime: new Date(status.lastOnlineTime),
  timeSinceLastOnline: status.timeSinceLastOnline,
  stable: NetworkStatusDetector.isConnectionStable(),
});
```

### 2. ุฑุณุงุฆู ุงูุชุดุฎูุต ุงููุญุณูุฉ

```typescript
// ุจุฏูุงู ูู [object Object]
logError("ุฎุทุฃ ูู ุงุณุชุนูุงู ุงูููุชุฌุงุช:", error, {
  operation: "get_products_query",
  errorType: this.categorizeNetworkError(error),
  isOnline: navigator.onLine,
  userAgent: navigator.userAgent,
});
```

### 3. ูู ุฃุฏุงุฉ ุชุดุฎูุต ุงูุงุชุตุงู

- **ุญุงูุฉ ุงูุดุจูุฉ**: ูุชุตู/ุบูุฑ ูุชุตู
- **ุฌูุฏุฉ ุงูุงุชุตุงู**: ุฌูุฏ/ุถุนูู/ูุนุทู
- **ุงุณุชูุฑุงุฑ ุงูุงุชุตุงู**: ูุณุชูุฑ/ุบูุฑ ูุณุชูุฑ
- **ุขุฎุฑ ุชุญุฏูุซ**: ููุช ุขุฎุฑ ูุญุต

---

## ๐ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

### ุฎุทุท ูุตูุฑุฉ ุงููุฏู:

- [ ] ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ููุตูุฉ ููุฃุฏุงุก
- [ ] ุชุญุณูู ุฎูุงุฑุฒููุฉ ูุดู ุฌูุฏุฉ ุงูุดุจูุฉ
- [ ] ุฅุถุงูุฉ ุชูุจููุงุช ูููุณุชุฎุฏู

### ุฎุทุท ุทูููุฉ ุงููุฏู:

- [ ] ูุธุงู ูุงุด ุฐูู ูุน ุชุญุฏูุซ ุฌุฒุฆู
- [ ] ุชุญุณูู ุชููุงุฆู ููุนุงููุงุช ุงูุดุจูุฉ
- [ ] ูุฒุงููุฉ ุฐููุฉ ูู ุงูุฎูููุฉ

---

## โ ุฎูุงุตุฉ

**ุชู ุญู ุฎุทุฃ "Failed to fetch" ุจุดูู ุดุงูู!**

### ุงูุญููู ุงููุทุจูุฉ:

1. โ **ุชุญุณูู ุดุงูู ูู getProducts()** - ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก
2. โ **ูุงุดู ุญุงูุฉ ุงูุดุจูุฉ ุงููุชูุฏู** - ูุฑุงูุจุฉ ุฐููุฉ ููุงุชุตุงู
3. โ **ุขููุฉ ุชุฑุงุฌุน ูุญุณูุฉ** - ุงุณุชุฎุฏุงู ุงููุงุด ุนูุฏ ุงูุญุงุฌุฉ
4. โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ** - ูุง ูุฒูุฏ ูู [object Object]
5. โ **ุญูุงูุฉ ุถุฏ ุงูุชุนููู** - ูููุฉ ุฒูููุฉ ูุญุฏุฏุฉ
6. โ **ุชุดุฎูุต ูุชูุฏู** - ุฃุฏูุงุช ูุฑุงูุจุฉ ุดุงููุฉ

### ุงููุชูุฌุฉ:

- ๐ซ **ูุง ูุฒูุฏ ูู ุฎุทุฃ "Failed to fetch" ุบูุฑ ุงููุนุงูุฌ**
- โ **ุงุณุชูุฑุงุฑูุฉ ุงูุฎุฏูุฉ** ูุน ุงููุงุด ุงููุญูู
- โ **ุฑุณุงุฆู ุฎุทุฃ ูููุฏุฉ ููุงุถุญุฉ**
- โ **ูุฑุงูุจุฉ ุฐููุฉ ููุดุจูุฉ**
- โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ**

ุงููุธุงู ุงูุขู ูุชุนุงูู ูุน ุฌููุน ุฃููุงุน ูุดุงูู ุงูุดุจูุฉ ุจุฐูุงุก ููููุฑ ุชุฌุฑุจุฉ ุณูุณุฉ ูููุณุชุฎุฏู! ๐
