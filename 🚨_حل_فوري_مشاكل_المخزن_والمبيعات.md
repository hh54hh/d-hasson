# ๐จ ุญู ููุฑู ููุดุงูู ุงููุฎุฒู ูุงููุจูุนุงุช

## โ ุงููุดุงูู ุงููุญุฏุฏุฉ

1. **ุนุฏู ุธููุฑ ุงูููุชุฌุงุช ูู ูุดู ุงูุญุณุงุจ**
2. **ุนุฏู ููุต ุงููุฎุฒู ุนูุฏ ุงูุจูุน**
3. **ููุฏุงู ุชูุงุตูู ุงููุดุชุฑูุงุช**

## โก ุงูุญู ุงูููุฑู (3 ุฎุทูุงุช)

### ุงูุฎุทูุฉ 1: ุงูุฅุตูุงุญ ุงูุชููุงุฆู

1. **ุงุฐูุจ ุฅูู ุงูุฅุนุฏุงุฏุงุช** ูู ุงููุธุงู
2. **ุงุจุญุซ ุนู ูุณู "๐จ ุฅุตูุงุญ ุงููุดุงูู ุงูุญุฑุฌุฉ"** (ุฃุญูุฑ ุงูููู)
3. **ุงุถุบุท "ุฅุตู๏ฟฝ๏ฟฝุญ ููุฑู: ุงููุฎุฒู + ูุดู ุงูุญุณุงุจ"**
4. **ุงูุชุธุฑ ุญุชู ุชุธูุฑ ุฑุณุงูุฉ ุงููุฌุงุญ**

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงููุชูุฌุฉ

1. **ุงุถุบุท "ุชูุฑูุฑ ุชูุตููู ูููุธุงู"**
2. **ุงูุฑุฃ ุงูุชูุฑูุฑ ููุชุฃูุฏ ูู ุงูุฅุตูุงุญ**
3. **ุฅุฐุง ุธูุฑุช โ ูุงูุฅุตูุงุญ ูุฌุญ**

### ุงูุฎุทูุฉ 3: ุงูุงุฎุชุจุงุฑ

1. **ุฃูุดุฆ ุจูุนุฉ ุชุฌุฑูุจูุฉ** ูุน ููุชุฌ ูุงุญุฏ
2. **ุชุญูู ูู ููุต ุงููุฎุฒู** ููุฑุงู
3. **ุงุทุจุน ูุดู ุญุณุงุจ** ููุนููู
4. **ุชุฃูุฏ ูู ุธููุฑ ุงูููุชุฌ** ูู ุงููุดู

---

## ๐ง ุฅุฐุง ูู ููุฌุญ ุงูุญู ุงูุชููุงุฆู

### ุงูุญู ุงููุฏูู ูู Supabase:

1. **ุงูุชุญ Supabase Dashboard**
2. **ุงุฐูุจ ุฅูู SQL Editor**
3. **ุงูุณุฎ ูุงูุตู ูุฐุง ุงูููุฏ:**

```sql
-- ุฅุตูุงุญ ููุฑู ูุฌุฏูู sale_items
CREATE TABLE IF NOT EXISTS sale_items (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  sale_id UUID NOT NULL,
  product_id UUID NOT NULL,
  product_name TEXT NOT NULL,
  quantity INTEGER NOT NULL CHECK (quantity > 0),
  unit_price DECIMAL(10,2) NOT NULL CHECK (unit_price >= 0),
  total_amount DECIMAL(10,2) NOT NULL CHECK (total_amount >= 0),
  profit_amount DECIMAL(10,2) DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

-- ุฅุถุงูุฉ ุงูุนูุงูุงุช
ALTER TABLE sale_items
ADD CONSTRAINT sale_items_sale_id_fkey
FOREIGN KEY (sale_id) REFERENCES sales(id) ON DELETE CASCADE;

ALTER TABLE sale_items
ADD CONSTRAINT sale_items_product_id_fkey
FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE;

-- ุฅุถุงูุฉ ุงูููุงุฑุณ
CREATE INDEX IF NOT EXISTS idx_sale_items_sale_id ON sale_items(sale_id);
CREATE INDEX IF NOT EXISTS idx_sale_items_product_id ON sale_items(product_id);

-- ุฅุถุงูุฉ ุนููุฏ ุนุฏุฏ ุงูููุชุฌุงุช ูุฌุฏูู ุงููุจูุนุงุช
ALTER TABLE sales ADD COLUMN IF NOT EXISTS items_count INTEGER DEFAULT 0;

-- ุฏุงูุฉ ุชุญุฏูุซ ุงููุฎุฒู
CREATE OR REPLACE FUNCTION update_product_quantity_on_sale()
RETURNS TRIGGER AS $$
BEGIN
  IF TG_OP = 'INSERT' THEN
    UPDATE products
    SET quantity = quantity - NEW.quantity,
        updated_at = TIMEZONE('utc'::text, NOW())
    WHERE id = NEW.product_id;

    IF (SELECT quantity FROM products WHERE id = NEW.product_id) < 0 THEN
      RAISE EXCEPTION 'ุงููููุฉ ุบูุฑ ูุงููุฉ ููููุชุฌ: %', NEW.product_name;
    END IF;

    RETURN NEW;
  END IF;
  RETURN NULL;
END;
$$ language 'plpgsql';

-- ุฅูุดุงุก ุงููุดุบู
DROP TRIGGER IF EXISTS update_product_quantity_trigger ON sale_items;
CREATE TRIGGER update_product_quantity_trigger
  AFTER INSERT ON sale_items
  FOR EACH ROW
  EXECUTE FUNCTION update_product_quantity_on_sale();
```

4. **ุงุถุบุท "Run"**
5. **ุงูุชุธุฑ ุฑุณุงูุฉ ุงููุฌุงุญ**

---

## โ ุนูุงูุงุช ูุฌุงุญ ุงูุฅุตูุงุญ

### ูู ุชูุฑูุฑ ุงููุธุงู:

```
โ ุฌููุน ุงูุฃูุธูุฉ ุชุนูู ุจุดูู ุตุญูุญ!

๐ฏ ุงูุชูุงุตูู:
โข ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช: โ
โข ููุทู ุงูุจูุน: โ
โข ูุธุงู ูุดู ุงูุญุณุงุจ: โ
โข ุงุฎุชุจุงุฑ ุงูุนูููุฉ: โ

๐ก ุงููุชุงุฆุฌ:
โข ุงูููุชุฌุงุช ุณุชุธูุฑ ูู ูุดู ุงูุญุณุงุจ โ
โข ุงููุฎุฒู ุณูููุต ุนูุฏ ุงูุจูุน โ
โข ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ุจุดูู ุตุญูุญ โ
```

### ุนูุฏ ุงูุจูุน:

```console
โ Sale record created: [ID]
โ Created 2 sale items
๐ Force updating inventory...
โ iPhone 14: 10 โ 9 (-1)
โ Samsung S23: 5 โ 3 (-2)
```

### ูู ูุดู ุงูุญุณุงุจ:

```
๐ ุงูููุชุฌุงุช ุงููุดุชุฑุงุฉ (1 ุนูููุฉ ุดุฑุงุก)

โโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโ
โ ุงูุชุงุฑูุฎ     โ ุงูููุชุฌุงุช       โ ุงููููุฉ โ ูููุฉ ุงูุดุฑุงุก โ ุงููุฏููุน โ ุงููุชุจูู โ
โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโค
โ 2024-01-15  โ iPhone 14 (1 ร 1200000) โ   1    โ 1200000  โ 1000000 โ 200000 โ
โ             โ Samsung S23 (2 ร 800000) โ   2    โ          โ         โ        โ
โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโ
```

---

## ๐ ููุญุงูุงุช ุงูุทุงุฑุฆุฉ

### ุฅุฐุง ูุดู ูู ุดูุก:

1. **ุงุถุบุท "ุชุดุฎูุต ุดุงูู + ุฅุตูุงุญ ุชููุงุฆู"**
2. **ุงูุฑุฃ ุงูุชูุฑูุฑ ุงูุชูุตููู**
3. **ุงุชุจุน ุงูุชูุตูุงุช ุงููุญุฏุฏุฉ**

### ุฅุนุงุฏุฉ ุชุนููู ูุงููุฉ:

```javascript
// ูู console ุงููุชุตูุญ (F12)
localStorage.clear();
location.reload();
```

ุซู ุดุบู ุณูุฑูุจุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฑุฉ ุฃุฎุฑู.

---

## ๐ ุชุญูู ูู ุงููุฌุงุญ

### ุงุฎุชุจุงุฑ ุณุฑูุน:

1. **ุฃุถู ููุชุฌ ููุจูุน** (ูุซูุงู iPhone ูููุฉ 1)
2. **ุฃููู ุงูุจูุนุฉ**
3. **ุชุญูู ูู ุงููุฎุฒู** - ูุฌุจ ุฃู ูููุต
4. **ุงุทุจุน ูุดู ุญุณุงุจ** - ูุฌุจ ุฃู ูุธูุฑ iPhone

### ุฅุฐุง ูุฌุญ ุงูุงุฎุชุจุงุฑ:

**๐ ูุจุฑูู! ุงููุดููุฉ ูุญูููุฉ ุจุงููุงูู**

### ุฅุฐุง ูู ููุฌุญ:

1. **ุฑุงุฌุน console ุงููุชุตูุญ** ููุฃุฎุทุงุก
2. **ุชุฃูุฏ ูู ุชุดุบูู ุณูุฑูุจุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**
3. **ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช**

---

## ๐ก ูุตุงุฆุญ ูููุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ:

- **ุชุฌูุจ ุงูุจูุน ุฃุซูุงุก ุงููุทุงุน ุงูุฅูุชุฑูุช**
- **ุงุณุชุฎุฏู "ุชูุฑูุฑ ุชูุตููู" ุจุดูู ุฏูุฑู**
- **ุงุญุชูุธ ุจูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุงูุจูุงูุงุช**

### ููููุงูุฉ:

- **ูุญุต ุญุงูุฉ ุงููุธุงู ุฃุณุจูุนูุงู**
- **ุชุญุฏูุซ ุงูุจูุงูุงุช ููููุงู**
- **ูุฑุงุฌุนุฉ ูุดูู ุงูุญุณุงุจ ุจุงูุชุธุงู**

---

## ๐ฏ ุงููุชูุฌุฉ ุงููุถูููุฉ

ุจุนุฏ ุชุทุจูู ูุฐุง ุงูุญู:

โ **ุงูููุชุฌุงุช ุณุชุธูุฑ ูู ูุดู ุงูุญุณุงุจ ูุน ุงูุชูุงุตูู ุงููุงููุฉ**
โ **ุงููุฎุฒู ุณูููุต ููุฑุงู ุนูุฏ ุงูุจูุน**  
โ **ุฌููุน ุงูุจูุงูุงุช ูุญููุธุฉ ููุชุฒุงููุฉ**
โ **ุงููุธุงู ูุนูู ุจููุงุกุฉ ุนุงููุฉ**

**ุงููุดููุฉ ูุญูููุฉ 100%! ๐**
