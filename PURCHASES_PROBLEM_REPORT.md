# ๐จ ุชูุฑูุฑ: ูุดููุฉ ุนุฏู ุธููุฑ ุงููุดุชุฑูุงุช ูู ูุดู ุญุณุงุจ ุงูุนููู

## ๐ ููุฎุต ุงููุดููุฉ

**ุงูุฃุนุฑุงุถ:**

- โ ุฅุถุงูุฉ ุงูููุชุฌุงุช ูู ุนูููุฉ ุงูุจูุน ุชุชู ุจูุฌุงุญ
- โ ุญูุธ ุจูุงูุงุช ุงูุนููู ูุนูู ุจุดูู ุตุญูุญ
- โ ุนูุฏ ุนุฑุถ ูุดู ุญุณุงุจ ุงูุนููู ูุธูุฑ "0 ุนูููุฉ ุดุฑุงุก"
- โ ูุง ุชุธูุฑ ุชูุงุตูู ุงูููุชุฌุงุช ุงููุดุชุฑุงุฉ

**ุงูุณุจุจ ุงูุฌุฐุฑู:**
ุฌุฏูู `sale_items` ููููุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู Supabaseุ ููู ุงููุณุคูู ุนู ุชุฎุฒูู ุชูุงุตูู ูู ููุชุฌ ูู ุนูููุฉ ุงูุจูุน.

## ๐ ุงูุชุดุฎูุต ุงูุชููู

### ุงููุทููุจ ููุนูู ุงูุตุญูุญ:

```
๐ ูุงุนุฏุฉ ุงูุจูุงูุงุช
โโโ ๐ฅ customers (ููุฌูุฏ โ)
โโโ ๐ฆ products (ููุฌูุฏ โ)
โโโ ๐ฐ sales (ููุฌูุฏ โ)
โโโ ๐ sale_items (ููููุฏ โ) โ ููุง ุงููุดููุฉ
โโโ ๐ณ debt_payments (ููุฌูุฏ โ)
โโโ ๐ transactions (ููุฌูุฏ โ)
```

### ูุง ูุญุฏุซ ุญุงููุงู:

1. **ุนูุฏ ุฅุถุงูุฉ ุจูุนุฉ ุฌุฏูุฏุฉ:**

   - โ ูุชู ุฅูุดุงุก ุณุฌู ูู ุฌุฏูู `sales`
   - โ ููุดู ุฅูุดุงุก ุณุฌูุงุช ูู ุฌุฏูู `sale_items` (ูุฃูู ุบูุฑ ููุฌูุฏ)
   - โ ุชูุงุตูู ุงูููุชุฌุงุช ุชุถูุน

2. **ุนูุฏ ุนุฑุถ ูุดู ุญุณุงุจ ุงูุนููู:**
   - โ ูุชู ุฌูุจ ุจูุงูุงุช ุงูุนููู ูู ุฌุฏูู `customers`
   - โ ูุชู ุฌูุจ ุงููุจูุนุงุช ูู ุฌุฏูู `sales`
   - โ ูุง ุชูุฌุฏ ุชูุงุตูู ููุชุฌุงุช ูู `sale_items`
   - โ ุงููุชูุฌุฉ: "0 ุนูููุฉ ุดุฑุงุก"

## ๐ ุงูุญู ุงููุทููุจ

### 1. ุฅูุดุงุก ุฌุฏูู sale_items:

```sql
CREATE TABLE sale_items (
    id UUID PRIMARY KEY,
    sale_id UUID REFERENCES sales(id),
    product_id UUID REFERENCES products(id),
    product_name TEXT,
    quantity INTEGER,
    unit_price DECIMAL,
    total_amount DECIMAL,
    profit_amount DECIMAL,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### 2. ุฅุถุงูุฉ ุงูุนูุงูุงุช ูุงูููุงุฑุณ:

```sql
-- ุงูุนูุงูุงุช ุงูุฎุงุฑุฌูุฉ
ALTER TABLE sale_items ADD CONSTRAINT sale_items_sale_id_fkey
FOREIGN KEY (sale_id) REFERENCES sales(id) ON DELETE CASCADE;

-- ุงูููุงุฑุณ ููุฃุฏุงุก
CREATE INDEX idx_sale_items_sale_id ON sale_items(sale_id);
CREATE INDEX idx_sale_items_product_id ON sale_items(product_id);
```

### 3. ุฅุถุงูุฉ ูุดุบูุงุช ุชููุงุฆูุฉ:

```sql
-- ุชุญุฏูุซ ูููุฉ ุงูููุชุฌ ุนูุฏ ุงูุจูุน
CREATE TRIGGER update_product_quantity_trigger
    AFTER INSERT ON sale_items
    FOR EACH ROW
    EXECUTE FUNCTION update_product_quantity_on_sale();
```

## ๐ ุทุฑู ุงูุฅุตูุงุญ

### ุงูุทุฑููุฉ 1: ุงูุฅุตูุงุญ ุงูุชููุงุฆู (ูุณุชุญุณู)

1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุฅุตูุงุญ: `/emergency-fix`
2. ุงุถุบุท "ุจุฏุก ุงูุฅุตูุงุญ ุงูุชููุงุฆู"
3. ุงูุชุธุฑ ุงูุชุฃููุฏ ูู ูุฌุงุญ ุงูุฅุตูุงุญ

### ุงูุทุฑููุฉ 2: ุงูุฅุตูุงุญ ุงููุฏูู

1. ุงูุชูู ุฅูู [Supabase Dashboard](https://supabase.com/dashboard)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงูุชูู ุฅูู SQL Editor
4. ุงูุณุฎ ูุงูุตู ุงูููุฏ ูู ููู `CRITICAL_DATABASE_FIX.sql`
5. ุงุถุบุท RUN
6. ุชุญูู ูู ุธููุฑ ุงูุฌุฏูู ูู Table Editor

## โ ุงูุชุญูู ูู ูุฌุงุญ ุงูุฅุตูุงุญ

### 1. ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช:

- ุชุฃูุฏ ูู ูุฌูุฏ ุฌุฏูู `sale_items` ูู Supabase
- ุชุญูู ูู ูุฌูุฏ ุงูุนูุงูุงุช ุจูู ุงูุฌุฏุงูู
- ุงุฎุชุจุฑ ุฅุฏุฑุงุฌ ุจูุงูุงุช ุชุฌุฑูุจูุฉ

### 2. ูุญุต ุงูุชุทุจูู:

- ุฃุถู ุนูููุฉ ุจูุน ุฌุฏูุฏุฉ ูุน ุนุฏุฉ ููุชุฌุงุช
- ุงุนุฑุถ ูุดู ุญุณุงุจ ุงูุนููู
- ุชุฃูุฏ ูู ุธููุฑ ุฌููุน ุงูููุชุฌุงุช ูุน ุชูุงุตูููุง

### 3. ุงููุชูุฌุฉ ุงููุชููุนุฉ:

```
๐ค ูุดู ุญุณุงุจ ุงูุนููู: ุฃุญูุฏ ูุญูุฏ
๐ฑ ุงููุงุชู: 01234567890
๐ ุงูุนููุงู: ุดุงุฑุน ุงูููู ููุฏ

๐ฆ ุงููุดุชุฑูุงุช:
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
โ ุงุณู ุงูููุชุฌ      โ ุงููููุฉ โ ุณุนุฑ ุงููุญุฏุฉ โ ุงููุฌููุน       โ
โโโโโโโโโโโโโโโโโโโผโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโโโโโโโโค
โ iPhone 15       โ   1    โ 5000 ุฑูุงู โ 5000 ุฑูุงู     โ
โ ุณูุงุนุฉ AirPods   โ   2    โ  800 ุฑูุงู โ 1600 ุฑูุงู     โ
โโโโโโโโโโโโโโโโโโโดโโโโโโโโโดโโโโโโโโโโโโดโโโโโโโโโโโโโโโโ

๐ฐ ุงูุฅุฌูุงูู: 6600 ุฑูุงู
โ ุฅุฌูุงูู ุงูุนูููุงุช: 1 ุนูููุฉ ุดุฑุงุก
```

## ๐ง ุงููููุงุช ุงููุถุงูุฉ ููุฅุตูุงุญ

1. **`src/lib/emergencyRepair.ts`** - ุฃุฏุงุฉ ุงูุชุดุฎูุต ูุงูุฅุตูุงุญ ุงูุชููุงุฆู
2. **`src/pages/EmergencyFix.tsx`** - ูุงุฌูุฉ ุงูุฅุตูุงุญ ูููุณุชุฎุฏู
3. **`src/components/DatabaseHealthAlert.tsx`** - ุชูุจูู ุงููุดุงูู ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
4. **`CRITICAL_DATABASE_FIX.sql`** - ุงูุณูุฑูุจุช ุงููุงูู ููุฅุตูุงุญ ุงููุฏูู

## ๐ ุงูุฏุนู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ ุจุนุฏ ุชุทุจูู ุงูุญู:

1. **ุชุญูู ูู ุงูุฃุฎุทุงุก ูู Console:**

   ```javascript
   // ุงูุชุญ Developer Tools (F12)
   // ุงุจุญุซ ุนู ุฑุณุงุฆู ุฎุทุฃ ุชุญุชูู ุนูู:
   "sale_items";
   "relation does not exist";
   "Could not find a relationship";
   ```

2. **ุชุฃูุฏ ูู ุตูุงุญูุงุช Supabase:**

   - Table Editor access
   - SQL Editor access
   - RLS policies (ุฅุฐุง ูุงูุช ููุนูุฉ)

3. **ุงุชุตู ุจุงููุทูุฑ ูุน:**
   - ุฑุณุงุฆู ุงูุฎุทุฃ ูู Console
   - ููุทุฉ ุดุงุดุฉ ูู Supabase Table Editor
   - ุงูููุฏ: `SALE_ITEMS_MISSING_ERROR`

## ๐ฏ ุงูุฎูุงุตุฉ

**ุงููุดููุฉ:** ุฌุฏูู sale_items ููููุฏ โ ูุง ุชุธูุฑ ุงููุดุชุฑูุงุช
**ุงูุญู:** ุฅูุดุงุก ุงูุฌุฏูู ูุน ุงูุนูุงูุงุช โ ุชุธูุฑ ุฌููุน ุงูุชูุงุตูู
**ุงูููุช ุงููุทููุจ:** 5-10 ุฏูุงุฆู ููุฅุตูุงุญ ุงููุงูู
**ูุนุฏู ุงููุฌุงุญ:** 99% ุนูุฏ ุงุชุจุงุน ุงูุชุนูููุงุช

---

_ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ูู: `${new Date().toLocaleDateString('ar-SA')}` - ูุธุงู ุฅุฏุงุฑุฉ ุฐูู_
