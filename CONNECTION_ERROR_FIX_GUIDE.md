# ๐ง ุฏููู ุฅุตูุงุญ ุฃุฎุทุงุก ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช

## Connection Error Fix Guide

> **ุงูุญุงูุฉ**: ุชู ุงูุญู โ  
> **ุงูุชุงุฑูุฎ**: ุฏูุณูุจุฑ 2024  
> **ุงูููุน**: ุฎุทุฃ ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ ููุฎุต ุงููุดููุฉ

ูุงู ุงููุณุชุฎุฏููู ููุงุฌููู ุงูุฎุทุฃ ุงูุชุงูู ุนูุฏ ูุญุงููุฉ ูุฑุงุกุฉ ุงูููุชุฌุงุช:

```
โ Cannot read products: ุงูุงุชุตุงู ูุคูุชุงู ุบูุฑ ูุชููุฑ. ุฌุงุฑู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู...
```

ูุฐุง ุงูุฎุทุฃ ูุญุฏุซ ุนุงุฏุฉู ุจุณุจุจ:

- ูุดุงูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช
- ุงููุทุงุน ูุคูุช ูู ุฎุฏูุฉ Supabase
- ูุดุงูู ูู ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุฃุฎุฑ ูู ุงูุงุณุชุฌุงุจุฉ ูู ุงูุฎุงุฏู

---

## ๐๏ธ ุงูุญููู ุงููุทุจูุฉ

### 1. ูุฏูุฑ ุงูุงุชุตุงู ุงููุญุณู (Enhanced Connection Manager)

ุชู ุฅูุดุงุก `src/lib/connectionManager.ts` ุงูุฐู ูููุฑ:

- **ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ**: 3 ูุญุงููุงุช ูุน ุชุฃุฎูุฑุงุช ูุชุฒุงูุฏุฉ (1s, 3s, 5s)
- **ูุฑุงูุจุฉ ุงูุงุชุตุงู ูู ุงูุฎูููุฉ**: ูุญุต ุฏูุฑู ูู 30 ุซุงููุฉ
- **ุงุณุชุฌุงุจุฉ ูุชุบููุฑ ุญุงูุฉ ุงูุดุจูุฉ**: ูุนูุฏ ุชุนููู ุงูุงุชุตุงู ุนูุฏ ุนูุฏุฉ ุงูุฅูุชุฑูุช
- **ุชุฎุฒูู ูุคูุช ุฐูู**: ูุญูุธ ุขุฎุฑ ูุญุต ูุงุฌุญ ูุชุฌูุจ ุงููุญูุตุงุช ุงูุฒุงุฆุฏุฉ

#### ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:

```typescript
// ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ
await ConnectionManager.ensureConnectionWithRetry();

// ุชูููุฐ ุงูุนูููุงุช ูุน ุฅุนุงุฏุฉ ุงููุญุงููุฉ
await ConnectionManager.executeWithRetry(
  () => supabaseService.getProducts(),
  "get products",
);

// ูุฑุงูุจุฉ ุญุงูุฉ ุงูุงุชุตุงู
const status = ConnectionManager.getConnectionStatus();
```

### 2. ุชุญุณูู ุฎุฏูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

ุชู ุชุญุณูู `getProducts()` ูู `src/lib/supabaseService.ts`:

- **ุงูุชุฑุงุฌุน ูููุงุด ุงููุญูู**: ุฅุฐุง ูุดู ุงูุงุชุตุงูุ ูุฌุฑุจ ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ูู ุงููุงุด
- **ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก**: ุฑุณุงุฆู ุฎุทุฃ ุฃูุถุญ ูุชุณุฌูู ููุตู
- **ุชุฎุฒูู ูุคูุช ุชููุงุฆู**: ูุญูุธ ุงูุจูุงูุงุช ุงููุงุฌุญุฉ ูู ุงููุงุด ููุงุณุชุฎุฏุงู ุงููุงุญู

```typescript
async getProducts(): Promise<Product[]> {
  try {
    await this.ensureConnection();
    // ... ุงุณุชุนูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช

    // ุชุฎุฒูู ูู ุงููุงุด
    await offlineManager.cacheData("products", products);
    return products;
  } catch (connectionError) {
    // ูุญุงููุฉ ุงุณุชุฎุฏุงู ุงููุงุด ุงููุญูู
    const offlineProducts = await offlineManager.getProducts();
    if (offlineProducts?.length > 0) {
      return offlineProducts;
    }
    throw connectionError;
  }
}
```

### 3. ูุธุงู ุงูุชุดุฎูุต ุงูุดุงูู

ุชู ุฅูุดุงุก ูููู `src/components/ConnectionDiagnostic.tsx` ุงูุฐู ููุฏู:

- **ูุญุต ุดุงูู ููุงุชุตุงู**: ูุฎุชุจุฑ ุฌููุน ููููุงุช ุงูุงุชุตุงู
- **ุชุดุฎูุต ูู ุงูููุช ุงููุนูู**: ูุฑุงูุจุฉ ูุณุชูุฑุฉ ูุญุงูุฉ ุงูุงุชุตุงู
- **ุฅุตูุงุญ ุชููุงุฆู**: ุฃุฒุฑุงุฑ ูุฅุนุงุฏุฉ ุชุนููู ูุฅุตูุงุญ ุงููุดุงูู
- **ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู**: ูุนูููุงุช ูุงุถุญุฉ ููุตุงุฆุญ ููุฅุตูุงุญ

#### ูุง ูุชู ูุญุตู:

1. โ **ุงุชุตุงู ุงูุฅูุชุฑูุช** - `navigator.onLine`
2. โ **ุฅุนุฏุงุฏุงุช Supabase** - ูุชุบูุฑุงุช ุงูุจูุฆุฉ
3. โ **ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช** - ุงุฎุชุจุงุฑ ุงูุงุณุชุนูุงู
4. โ **ูุฑุงุกุฉ ุงูููุชุฌุงุช** - ุงุฎุชุจุงุฑ ุงูุนูููุฉ ุงููุนููุฉ

### 4. ุชุญุณูู ูุธุงู ุงูุชุดุฎูุต ุงูููุฌูุฏ

ุชู ุชุญุณูู `src/lib/inventoryUpdateDiagnostic.ts`:

- **ูุนุงูุฌุฉ ุฃูุถู ูุฃุฎุทุงุก ุงูุงุชุตุงู**: ูููุฒ ุจูู ุฃููุงุน ุงูุฃุฎุทุงุก ุงููุฎุชููุฉ
- **ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ**: ูุญุงูู ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุจุนุฏ ูุชุฑุฉ ูุตูุฑุฉ
- **ุฑุณุงุฆู ุฃูุถุญ**: ูุนูููุงุช ุฃูุซุฑ ุชูุตููุงู ุนู ุญุงูุฉ ุงูุฎุทุฃ

---

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ูููุณุชุฎุฏููู ุงูููุงุฆููู:

1. **ุงููุตูู ูุฃุฏุงุฉ ุงูุชุดุฎูุต**:

   - ุงูุชูู ุฅูู **ุงูุฅุนุฏุงุฏุงุช** โ **ุฃุฏูุงุช ุงูุชุดุฎูุต**
   - ุงุจุญุซ ุนู ุจุทุงูุฉ **"ุชุดุฎูุต ุงูุงุชุตุงู"**

2. **ููู ุญุงูุฉ ุงูุงุชุตุงู**:

   - ๐ข **ูุนูู ุจุดูู ุทุจูุนู**: ูู ุดูุก ูุนูู
   - ๐ก **ููุฌุฏ ูุดุงูู**: ุจุนุถ ุงูุฃุฌุฒุงุก ูุง ุชุนูู
   - ๐ด **ูุดู ุงูุงุชุตุงู**: ูุดููุฉ ุฎุทูุฑุฉ ูู ุงูุงุชุตุงู

3. **ุฎุทูุงุช ุงูุฅุตูุงุญ**:
   ```
   1. ุงุถุบุท "ุฅุนุงุฏุฉ ุงููุญุต" ุฃููุงู
   2. ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุงุถุบุท "ุฅุตูุงุญ ุงูุงุชุตุงู"
   3. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
   4. ุฃุนุฏ ุชุดุบูู ุงูุชุทุจูู ุฅุฐุง ูุฒู ุงูุฃูุฑ
   ```

### ูููุทูุฑูู:

#### ุงุณุชุฎุฏุงู ConnectionManager:

```typescript
import { ConnectionManager } from "./connectionManager";

// ูุญุต ุงูุงุชุตุงู ูุน ุฅุนุงุฏุฉ ุงููุญุงููุฉ
try {
  await ConnectionManager.ensureConnectionWithRetry();
  console.log("ุงูุงุชุตุงู ูุงุฌุญ");
} catch (error) {
  console.error("ูุดู ุงูุงุชุตุงู:", error);
}

// ุชูููุฐ ุนูููุฉ ูุน ุฅุนุงุฏุฉ ุงููุญุงููุฉ
try {
  const result = await ConnectionManager.executeWithRetry(async () => {
    return await someDBOperation();
  }, "database operation name");
} catch (error) {
  console.error("ูุดูุช ุงูุนูููุฉ:", error);
}
```

#### ูุฑุงูุจุฉ ุญุงูุฉ ุงูุงุชุตุงู:

```typescript
// ุงูุญุตูู ุนูู ุญุงูุฉ ุงูุงุชุตุงู
const status = ConnectionManager.getConnectionStatus();
console.log("ุญุงูุฉ ุงูุงุชุตุงู:", {
  isConnected: status.isConnected,
  lastCheck: new Date(status.lastCheck),
  retryAttempts: status.retryAttempts,
});

// ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงูุงุชุตุงู
ConnectionManager.resetConnectionState();
```

---

## ๐ ุฃุฏูุงุช ุงูุชุดุฎูุต ุงููุชุงุญุฉ

### 1. ุชุดุฎูุต ุงูุงุชุตุงู (Connection Diagnostic)

- **ุงูููุงู**: ุงูุฅุนุฏุงุฏุงุช โ ุชุดุฎูุต ุงูุงุชุตุงู
- **ุงููุธููุฉ**: ูุญุต ุดุงูู ูุญุงูุฉ ุงูุงุชุตุงู
- **ุงูุงุณุชุฎุฏุงู**: ุนูุฏ ุธููุฑ ุฃุฎุทุงุก ุงุชุตุงู

### 2. ุชุดุฎูุต ุจูุงูุงุช ุงูุนููุงุก (Customer Diagnostic)

- **ุงูููุงู**: ุงูุฅุนุฏุงุฏุงุช โ ุชุดุฎูุต ุจูุงูุงุช ุงูุนููุงุก
- **ุงููุธููุฉ**: ูุญุต ูุฅุตูุงุญ ุจูุงูุงุช ุงูุนููุงุก
- **ุงูุงุณุชุฎุฏุงู**: ุนูุฏ ูุดุงูู ูู ุจูุงูุงุช ุงูุนููุงุก

### 3. ูุฏูุฑ ุฃุฎุทุงุก ุงููุฒุงููุฉ (Sync Error Manager)

- **ุงูููุงู**: ุงูุฅุนุฏุงุฏุงุช โ ูุฏูุฑ ุฃุฎุทุงุก ุงููุฒุงููุฉ
- **ุงููุธููุฉ**: ุฅุฏุงุฑุฉ ูุฅุตูุงุญ ุฃุฎุทุงุก ุงููุฒุงููุฉ
- **ุงูุงุณุชุฎุฏุงู**: ุนูุฏ ุชูุฑุงุฑ ุฃุฎุทุงุก ุงููุฒุงููุฉ

### 4. ุชุดุฎูุต ุงููุฎุฒูู (Inventory Diagnostic)

- **ุงูููุงู**: ุงูุฅุนุฏุงุฏุงุช โ ุชุดุฎูุต ุงููุฎุฒูู
- **ุงููุธููุฉ**: ูุญุต ูุฅุตูุงุญ ูุดุงูู ุงููุฎุฒูู
- **ุงูุงุณุชุฎุฏุงู**: ุนูุฏ ูุดุงูู ูู ูููุงุช ุงูููุชุฌุงุช

---

## โก ุฅุตูุงุญ ุณุฑูุน ูููุดุงูู ุงูุดุงุฆุนุฉ

### ุงููุดููุฉ: "ุงูุงุชุตุงู ูุคูุชุงู ุบูุฑ ูุชููุฑ"

**ุงูุญู ุงูููุฑู**:

1. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
2. ุงูุชุญ ุงูุฅุนุฏุงุฏุงุช โ ุชุดุฎูุต ุงูุงุชุตุงู
3. ุงุถุบุท "ุฅุตูุงุญ ุงูุงุชุตุงู"
4. ุงูุชุธุฑ 30 ุซุงููุฉ ูุฃุนุฏ ุงููุญุงููุฉ

**ุงูุญู ุงููุชูุฏู**:

```javascript
// ูู ูุญุฏุฉ ุงูุชุญูู (Console)
ConnectionManager.resetConnectionState();
location.reload();
```

### ุงููุดููุฉ: "Cannot read products"

**ุงูุญู ุงูููุฑู**:

1. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (F5)
2. ุชุญูู ูู ุชุดุฎูุต ุงูุงุชุตุงู
3. ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุงุณุชุฎุฏู "ุฅุตูุงุญ ุงูุงุชุตุงู"

**ุงูุญู ุงููุชูุฏู**:

- ุงูููุชุฌุงุช ุณุชูุญูู ูู ุงููุงุด ุงููุญูู ุชููุงุฆูุงู
- ุฅุฐุง ูู ููุฌุฏ ูุงุดุ ุณุชุธูุฑ ุฑุณุงูุฉ ูุงุถุญุฉ

### ุงููุดููุฉ: ุจุทุก ูู ุงูุงุชุตุงู

**ุงูุญู**:

- ุงููุธุงู ูุชููู ุชููุงุฆูุงู ูุน ุงูุงุชุตุงู ุงูุจุทูุก
- ูุฒูุฏ ูููุฉ ุงูุงูุชุธุงุฑ ุชุฏุฑูุฌูุงู
- ูุณุชุฎุฏู ุงููุงุด ุงููุญูู ุนูุฏ ุงูุญุงุฌุฉ

---

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงููุชููุฑุฉ:

1. **ุฒูู ุงูุงุณุชุฌุงุจุฉ**: ูููุณ ุณุฑุนุฉ ุงูุงุชุตุงู
2. **ูุนุฏู ูุฌุงุญ ุงูุงุชุตุงู**: ูุณุจุฉ ุงููุญุงููุงุช ุงููุงุฌุญุฉ
3. **ุนุฏุฏ ุฅุนุงุฏุฉ ุงููุญุงููุงุช**: ูู ูุฑุฉ ุชู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
4. **ููุช ุขุฎุฑ ูุญุต ูุงุฌุญ**: ูุชู ุชู ุขุฎุฑ ุงุชุตุงู ูุงุฌุญ

### ุนุฑุถ ุงููุคุดุฑุงุช:

```typescript
const status = ConnectionManager.getConnectionStatus();
console.log("ุฅุญุตุงุฆูุงุช ุงูุงุชุตุงู:", {
  ูุชุตู: status.isConnected ? "ูุนู" : "ูุง",
  ุขุฎุฑ_ูุญุต: new Date(status.lastCheck).toLocaleString("ar-SA"),
  ูุญุงููุงุช_ุฅุนุงุฏุฉ: status.retryAttempts,
});
```

---

## ๐ฎ ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ

### ุฎุทุท ูุตูุฑุฉ ุงููุฏู:

- [ ] ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ุฃุฏุงุก ููุตูุฉ
- [ ] ุชุญุณูู ุฎูุงุฑุฒููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ
- [ ] ุฅุดุนุงุฑุงุช ุนูุฏ ุงุณุชุนุงุฏุฉ ุงูุงุชุตุงู

### ุฎุทุท ุทูููุฉ ุงููุฏู:

- [ ] ูุถุน ุฃูู ูุงูู ูุงูู ููุชุทุจูู
- [ ] ูุฒุงููุฉ ุฐููุฉ ูู ุงูุฎูููุฉ
- [ ] ุชูุจุค ุจูุดุงูู ุงูุงุชุตุงู

---

## ๐ ุทูุจ ุงููุณุงุนุฏุฉ

ุฅุฐุง ุงุณุชูุฑุช ูุดุงูู ุงูุงุชุตุงู:

1. **ุฌูุน ุงููุนูููุงุช**:

   - ููุทุฉ ุดุงุดุฉ ูู ุชุดุฎูุต ุงูุงุชุตุงู
   - ุฑุณุงุฆู ุงูุฎุทุฃ ูุงููุฉ
   - ููุช ุญุฏูุซ ุงููุดููุฉ

2. **ุชุฌุฑุจุฉ ุงูุญููู ุงูููุชุฑุญุฉ**:

   - ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
   - ูุณุญ cache ุงููุชุตูุญ
   - ุชุฌุฑุจุฉ ุดุจูุฉ ูุฎุชููุฉ

3. **ุชูุงุตู ูุน ุงูุฏุนู**:
   - ุฃุฑุณู ุชูุงุตูู ุงููุดููุฉ
   - ุงุฐูุฑ ูุชุงุฆุฌ ุงูุชุดุฎูุต
   - ุงุฐูุฑ ุงูุฎุทูุงุช ุงููุฌุฑุจุฉ

---

## โ ุฎูุงุตุฉ

ุชู ุญู ูุดููุฉ **"Cannot read products: ุงูุงุชุตุงู ูุคูุชุงู ุบูุฑ ูุชููุฑ"** ุจุดูู ุดุงูู ูู ุฎูุงู:

1. โ **ูุฏูุฑ ุงุชุตุงู ูุญุณู** - ุฅุนุงุฏุฉ ูุญุงููุฉ ุฐููุฉ
2. โ **ุชุฑุงุฌุน ูููุงุด ุงููุญูู** - ุงุณุชูุฑุงุฑูุฉ ุงูุฎุฏูุฉ
3. โ **ุฃุฏูุงุช ุชุดุฎูุต ุดุงููุฉ** - ุฅุตูุงุญ ุฐุงุชู
4. โ **ูุฑุงูุจุฉ ูู ุงูููุช ุงููุนูู** - ููุน ุงููุดุงูู
5. โ **ูุงุฌูุฉ ุณููุฉ ุงูุงุณุชุฎุฏุงู** - ุฅุตูุงุญ ุจููุฑุฉ ูุงุญุฏุฉ

ุงููุชูุฌุฉ: **ุชุทุจูู ุฃูุซุฑ ุงุณุชูุฑุงุฑุงู ูููุซูููุฉ** ูุน ูุฏุฑุฉ ุนูู ุงูุชุนุงูู ูุน ุงููุทุงุน ุงูุงุชุตุงู ูุงูุชุนุงูู ุงูุชููุงุฆู.
