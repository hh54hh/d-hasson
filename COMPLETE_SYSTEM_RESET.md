# تفريغ النظام بالكامل - Complete System Reset

## الميزات المضافة

### 1. أداة التفريغ الشامل

**ملف**: `src/lib/completeSystemReset.ts`

**الوظائف الرئيسية**:

- `resetEverything()`: تفريغ النظام بالكامل
- `verifySystemEmpty()`: التحقق من أن النظام فارغ
- `deleteAllCustomers()`: حذف جميع العملاء
- `deleteAllProducts()`: حذف جميع المنتجات
- `deleteSales()`: حذف جميع المبيعات
- `clearLocalStorage()`: تنظيف الذاكرة المحلية

### 2. واجهة المستخدم في الإعدادات

**المكان**: صفحة الإعدادات - قسم "تفريغ النظام بالكامل"

**التصميم**:

- **حدود حمراء** للتأكيد على الخطر
- **خلفية حمراء فاتحة** للتحذير
- **أيقونة تحذير** واضحة
- **نص تحذيري** صريح
- **زر أحمر** بخط عريض

```typescript
{/* Complete System Reset Section */}
<div className="border-2 border-red-500 rounded-lg p-4 bg-red-100">
  <h4 className="font-bold text-red-900 mb-3 flex items-center gap-2">
    <AlertCircle className="h-5 w-5" />
    🔥 تفريغ النظام بالكامل
  </h4>
  <p className="text-red-800 text-sm mb-3">
    ⚠️ خطر شديد: سيحذف جميع البيانات نهائياً
  </p>
  <Button className="bg-red-700 hover:bg-red-800">
    تفريغ وإعادة تعيين النظام بالكامل
  </Button>
</div>
```

### 3. نظام التأكيد المتدرج

#### المرحلة الأولى - التحذير الأولي

```
⚠️ تحذير خطير ⚠️

هذا الإجراء سيحذف جميع البيانات نهائياً:

• جميع العملاء والمنتجات
• جميع عمليات البيع والمشتريات
• جميع المعاملات والديون
• جميع البيانات المحلية

هذا الإجراء لا يمكن التراجع عنه!

هل أنت متأكد؟
```

#### المرحلة الثانية - التأكيد بالكتابة

```
للتأكيد من هذا الإجراء الخطير، اكتب النص التالي بالضبط:

احذف جميع البيانات نهائياً
```

#### المرحلة الثالثة - التحذير الأخير

```
⚠️ التحذير الأخير ⚠️

ستفقد جميع البيانات إلى الأبد!

هل أنت متأكد 100% من المتابعة؟
```

### 4. عملية التفريغ المتسلسلة

#### الخطوة 1: حذف العلاقات

```typescript
// حذف العلاقات أولاً لتجنب Foreign Key errors
await this.deleteSaleItems();
await this.deleteDebtPayments();
await this.deleteTransactions();
```

#### الخطوة 2: حذف البيانات الأساسية

```typescript
// حذف المبيعات
const salesCount = await this.deleteSales();

// حذف العملاء
const customersCount = await this.deleteAllCustomers();

// حذف المنتجات
const productsCount = await this.deleteAllProducts();
```

#### الخطوة 3: تنظيف الذاكرة

```typescript
// تنظيف الذاكرة المحلية
this.clearLocalStorage();

// تنظيف Offline Cache
offlineManager.clearAllCache();
```

#### الخطوة 4: إعادة تعيين الإعدادات

```typescript
// إعادة تعيين ConnectionThrottler
ConnectionThrottler.reset();

// إعادة تعيين OfflineManager
offlineManager.reset();
```

### 5. التحقق والتأكيد

#### تقرير النتائج

```
✅ تم تفريغ النظام بالكامل بنجاح!

التفاصيل:
• عملاء محذوفين: 15
• منتجات محذوفة: 25
• مبيعات محذوفة: 87
• عناصر مبيعات محذوفة: 156
• دفعات ديون محذوفة: 23
• معاملات محذوفة: 45
• تم تنظيف الذاكرة المحلية: نعم
• تم تنظيف الـ cache: نعم

النظام فارغ الآن ومستعد للبدء من جديد!
```

#### التحقق النهائي

```typescript
const verification = await CompleteSystemReset.verifySystemEmpty();

if (verification.isEmpty) {
  alert("✅ تم التحقق: النظام فارغ بالكامل");
} else {
  // تحذير إذا كانت هناك بيانات متبقية
}
```

## الاستخدام

### 1. تنظيف البيانات الوهمية فقط

1. اذهب إلى **الإعدادات**
2. في قسم **"الإصلاحات الحرجة"**
3. اضغط **"حذف جميع البيانات الوهمية"**
4. راجع التقرير واضغط **تأكيد**

### 2. تفريغ النظام بالكامل

1. اذهب إلى **الإعدادات**
2. انزل إلى قسم **"تفريغ النظام بالكامل"** (الأحمر)
3. اضغط **"تفريغ وإعادة تعيين النظام بالكامل"**
4. اتبع التأكيدات الثلاثة:
   - موافقة على التحذير
   - كتابة النص المطلوب
   - تأكيد نهائي
5. انتظر اكتمال العملية (قد تستغرق دقائق)
6. راجع التقرير النهائي

## الحماية والأمان

### ✅ حماية من الحذف العرضي

- **3 مراحل تأكيد** منفصلة
- **كتابة نص محدد** للتأكيد
- **تحذيرات واضحة** في كل مرحلة
- **ألوان حمراء** للتنبيه

### ✅ حذف آمن

- **حذف العلاقات أولاً** لتجنب Database errors
- **معالجة الأخطاء** في كل خطوة
- **استمرار العملية** حتى لو فشلت خطوة واحدة
- **تقرير مفصل** لكل ما تم حذفه

### ✅ تحقق نهائي

- **فحص النظام** بعد التفريغ
- **تأكيد الفراغ** أو تحذير من البيانات المتبقية
- **إعادة تحميل الصفحة** لضمان حالة نظيفة

## الفوائد

✅ **إزالة البيانات الوهمية**: حذف المنتجات والعملاء التجريبيين  
✅ **بداية نظيفة**: نظام فارغ مستعد للبيانات الحقيقية  
✅ **حل المشاكل**: إصلاح مشاكل البيانات المعقدة  
✅ **اختبار النظام**: بيئة نظيفة للاختبار  
✅ **أمان كامل**: حماية من الحذف العرضي

## تحذير مهم

⚠️ **هذا الإجراء نهائي ولا يمكن التراجع عنه!**

- لا توجد طريقة لاستعادة البيانات بعد الحذف
- تأكد من عمل نسخة احتياطية إذا كانت لديك بيانات مهمة
- استخدم هذه الميزة فقط عند الحاجة لبداية جديدة كاملة

الآن لديك تحكم كامل في تنظيف وإعادة تعيين النظام! 🔥
